---
import ExperienceItem from "@/components/Experience/ExperienceItem.astro";
import Briefcase from "@/components/icons/Briefcase.astro";
const EXPERIENCE = [
    {
        date: "Ago. 2024 - Actualmente..",
        title: "Desarrollador Web Fullstack",
        company: "Servicios Computables S.A.",
        actual: false,
        usos: ['Vue', 'Laravel', 'Docker', 'MySQL'],
        description:
            "Desarrollo de sistemas inform치ticos para las distintas Municipalidades de la Rep칰blica Argentina.",
        aprendizajes: "Perfeccionamiento de tecnolog칤as frontend. Reutilizaci칩n de componentes y estados de Vue. Mejora en el uso de Docker."

    },
    {
        date: "Jun. 2021 - Abr. 2023",
        title: "Desarrollador Web Fullstack",
        company: "Servicios Computables S.A.",
        actual: false,
        usos: ['React', 'Laravel', 'Docker', 'MySQL'],
        description:
            "Desarrollo de sistemas inform치ticos para las distintas Municipalidades de la Rep칰blica Argentina.",
        aprendizajes: "Desarrollo personal y laboral en frontend. Manejo de estados y hooks de React. Desarrollo de test unitarios."

    },
    {
        date: "Nov. 2020 - May. 2021",
        title: "Desarrollador Web Backend",
        company: "Creative Coefficient",
        actual: false,
        usos: ['Prestashop', 'React', 'Docker'],
        description:
            "Desarrollo en conjunto de panel administrativo de un sistema de millas reconocido internacionalmente (Smiles).",
        aprendizajes: "Manejo de CMS, comunicaci칩n directa con clientes de Estados Unidos mediante dailies en ingl칠s."

    },
    {
        date: "Dic. 2018 - Ene. 2021",
        title: "Desarrollador Web Fullstack",
        company: "CNRT (Ministerio de Transporte)",
        actual: false,
        usos: ['Symfony', 'AngularJS', 'Angular', 'MySQL'],
        description:
            "Mantenimiento y desarrollo de sistemas internos y externos para transportes p칰blicos de corta y larga distancia.",
        aprendizajes: "Inicio como Trainee. Lenguaje puro a Frameworks. S칩lida base en seguridad, arquitectura de datos y optimizaci칩n de consultas SQL."
    },
]
---

<section class="timeline-wrapper">
    <h2 class="flex items-center mb-6 text-3xl font-semibold gap-x-3 text-black/80 dark:text-white">
        <Briefcase class="size-8"/>
        Experiencia laboral
    </h2>


    <div class="timeline-mask">
        <div class="timeline" id="timeline">
            <div class="timeline-line"></div>

            {EXPERIENCE.map((exp) => (
                    <article class="timeline-item">
                        <!--<span class="dot" class:list={{ actual: exp.actual }}></span>-->
                        <ExperienceItem experience={exp}/>
                    </article>
            ))}
        </div>
    </div>
</section>

<style>
    /* ===== SECTION ===== */

    .experience-section {
        padding: 4rem 0;
        display: flex;
        justify-content: center;
    }

    /* ===== MASK (fade edges) ===== */

    .timeline-mask {
        width: 110%;
        margin-left: -5%;
        overflow: hidden;

        /* el fade posta */
        mask-image: linear-gradient(
                90deg,
                transparent 0%,
                black 3%,
                black 97%,
                transparent 100%
        );
        -webkit-mask-image: linear-gradient(
                90deg,
                transparent 0%,
                black 3%,
                black 97%,
                transparent 100%
        );
    }

    /* ===== TIMELINE ===== */

    .timeline {
        position: relative;
        display: flex;
        gap: 4rem;
        padding: 2rem;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-behavior: smooth;
        overscroll-behavior: contain;
        scroll-snap-type: x mandatory;
    }

    .timeline.no-snap {
        scroll-snap-type: none;
    }

    .timeline-line {
        position: absolute;
        top: 170px;
        left: 0;
        height: 2px;
        background: linear-gradient(
                90deg,
                transparent,
                rgba(34, 197, 94, 0.4),
                transparent
        );
        pointer-events: none;
    }

    /* ===== ITEM ===== */

    .timeline-item {
        position: relative;
        min-width: 380px;
        scroll-snap-align: center;
    }

    .dot {
        position: absolute;
        top: 163px;
        left: 50%;
        transform: translateX(-50%);
        width: 14px;
        height: 14px;
        background: #22c55e;
        border-radius: 50%;
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.15);
        z-index: 2;
    }

</style>
<script>
    const timeline = document.getElementById('timeline')
    const timelineWrapper = document.querySelector('.timeline-wrapper')
    let snapTimeout

    if (timeline && timelineWrapper) {
        const handleWheel = (e) => {
            if (window.innerWidth < 768) return

            // Verificar si el scroll est치 dentro de la zona del timeline-wrapper
            const wrapperRect = timelineWrapper.getBoundingClientRect()
            const isInWrapperZone = 
                e.clientY >= wrapperRect.top && 
                e.clientY <= wrapperRect.bottom

            if (!isInWrapperZone) return

            const maxScrollLeft =
                timeline.scrollWidth - timeline.clientWidth
            const isAtStart = timeline.scrollLeft <= 0
            const isAtEnd = timeline.scrollLeft >= maxScrollLeft - 1

            const scrollingRight = e.deltaY > 0
            const scrollingLeft = e.deltaY < 0

            // 游댑 Si ya no hay m치s scroll horizontal, liberar el scroll vertical
            if (
                (isAtEnd && scrollingRight) ||
                (isAtStart && scrollingLeft)
            ) {
                timeline.classList.remove('no-snap')
                return
            }

            // 游 Mientras haya scroll horizontal, lo interceptamos
            e.preventDefault()
            e.stopPropagation()

            timeline.classList.add('no-snap')
            timeline.scrollLeft += e.deltaY * 0.8

            clearTimeout(snapTimeout)
            snapTimeout = setTimeout(() => {
                timeline.classList.remove('no-snap')
            }, 150)
        }

        // Escuchar el evento wheel en toda la secci칩n y en el timeline
        timelineWrapper.addEventListener('wheel', handleWheel, {passive: false})
        timeline.addEventListener('wheel', handleWheel, {passive: false})
    }
</script>
